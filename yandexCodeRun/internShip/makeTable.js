/* Отображение таблицы в консоль

    Напишите функцию makeTable, которая будет формировать строку для отображения таблицы в виде текста.
    У таблицы обязаны определяться размеры в зависимости от контента внутри неё. В качестве границ
    по вертикали используйте символ |. Для отображения углов нужно использовать символ #.
    Соответственно, для горизонтальной границы следует использовать символ =. Для null или undefined
    нужно писать прочерк (-). В случае если таблица пуста, т. е. список колонок пуст (а не то, что значения
    в каждых колонках пусты), следует вернуть пустую строку.

    Входные данные
    Первый аргумент функции makeTable — это список данных, которые следует отобразить. В списке всегда
    будут объекты. Второй аргумент функции — это порядок колонок, которые будут отображаться, которые
    соответствуют ключам объектов в списках данных. Если данных нет во всей колонке, колонку всё равно
    нужно отобразить, даже если все значения undefined или null.
    
*/
export function makeTable(data, columns) {

    if (!Array.isArray(columns) || columns.length === 0) {
        return '';
    }
    if (!Array.isArray(data)) {
        return '';
    }


    const widths = columns.map(col => {
        let maxWidth = col.length;
        for (const row of data) {
            if (row && typeof row === 'object') {
                const val = row[col];
                const str = (val == null) ? '-' : String(val);
                maxWidth = Math.max(maxWidth, str.length);
            }
        }
        return maxWidth;
    });


    const makeBorder = () => '#' + widths.map(w => '='.repeat(w)).join('#') + '#';

    const makeRow = (values) => '|' + values.map((val, i) => val.padEnd(widths[i], ' ')).join('|') + '|';

    let lines = [];
    lines.push(makeBorder());
    lines.push(makeRow(columns));
    lines.push(makeBorder());


    for (const row of data) {
        if (row && typeof row === 'object') {
            const rowValues = columns.map(col => {
                const val = row[col];
                return (val == null) ? '-' : String(val);
            });
            lines.push(makeRow(rowValues));
            lines.push(makeBorder());
        }
    }

    const result = lines.join('\n');    

    return result;
}


/* module.exports = makeTable; */

/* 1. Проверка входных данных

   2. Расчет ширины колонок. Для каждой колонки определяем максимальную ширину. Это максимум из:
        - длина названия колонки;
        - длина всех значений в этой колонке.
      Значение конвертируются в строки.

   3.Генерация границы - makeBorder.

   4.Генерация заголовка. Строка с названиями колонок, разделёнными |, с padding пробелами
   до ширины колонки (используем padEnd).

   5. Сборка строк таблицы. 
        Создаётся массив lines для хранения всех строк таблицы.
        Сначала добавляется верхняя граница (makeBorder()).
        Затем строка заголовков: makeRow(columns) — использует названия колонок как значения.
        Снова граница.

        Для каждой каждой строки данных:
        - берем значение по ключу колонки;
        - если значение null/udefined, заменяем на "-";
        - конвертируем строку и добавляем пробелы val.padEnd(widths[i], ' ') до ширины колонки
        *i-индекс i соответствует колонке;
        - собираем строку с "|" в начале и конце.

   6. Возвращаем результат. 
        Все строки из lines соединяются через символ новой строки (\n), образуя итоговую строку таблицы.
*/